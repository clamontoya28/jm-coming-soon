<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beta Annina-JM</title>
  <link rel="canonical" href="https://jmenterprises.it/src/chat.html" />
  <link rel="icon" href="https://jmenterprises.it/assets/annina.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #181818;
      --primary-light: #fff;
      --primary-dark: #181818;
      --accent: #d4af37;
      --user-bubble: #fff;
      --annina-bubble: #f7f7f7;
      --border: #181818;
      --shadow: 0 2px 12px 0 rgba(60,60,60,0.07);
      --radius: 18px;
      --radius-lg: 24px;
      --input-bg: #fff;
      --input-border: #d4af37;
      --input-focus: #d4af37;
      --header-bg: #181818;
      --header-border: #d4af37;
      --icon-muted: #b0b0b0;
      --transition: 0.18s cubic-bezier(.4,0,.2,1);
      --text-bright: #fff;
      --text-bright-secondary: #e6eaf0;
      --avatar-glow: none;
    }
    /* Popup tema navbar */
    .theme-popup-wrapper {
      position: relative;
      display: inline-block;
    }
    .theme-popup-btn {
      background: rgba(40,40,50,0.85);
      border: 2px solid var(--border, #444);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.35rem;
      color: var(--accent, #b0b0b0);
      cursor: pointer;
      margin-right: 0.3em;
      transition: box-shadow 0.18s, border 0.18s, background 0.18s;
      box-shadow: 0 2px 8px 0 #0002;
      backdrop-filter: blur(2px);
    }
    .theme-popup-btn:focus,
    .theme-popup-btn[aria-expanded="true"] {
      box-shadow: 0 0 0 4px var(--border, #8885);
      outline: none;
      border-color: var(--accent, #888);
    }
    .theme-popup-menu {
      display: none;
      position: absolute;
      top: 120%;
      right: 0;
      min-width: 210px;
      background: rgba(30,32,40,0.97);
      border: 2px solid var(--border, #444);
      border-radius: 22px;
      box-shadow: 0 8px 32px 0 #0005;
      z-index: 100;
      padding: 0.5em 0.2em;
      font-size: 1.08rem;
      animation: fadeIn 0.18s;
      backdrop-filter: blur(8px) saturate(1.1);
    }
    .theme-popup-menu.open {
      display: block;
    }
    .theme-option {
      display: flex;
      align-items: center;
      gap: 1.1em;
      padding: 0.85em 1.2em;
      cursor: pointer;
      border-radius: 16px;
      margin: 0.15em 0.1em;
      font-weight: 500;
      letter-spacing: 0.01em;
      transition: background 0.18s, color 0.18s, box-shadow 0.18s;
      border: 2px solid transparent;
    }
    .theme-option:hover, .theme-option.selected {
      background: rgba(80,90,110,0.18);
      color: var(--accent, #ffe066);
      border: 2px solid var(--border, #888);
      box-shadow: 0 2px 8px 0 var(--border, #8882);
    }
    .theme-dot {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2.5px solid var(--border, #888);
      box-shadow: 0 0 0 2px var(--border, #8882);
      display: inline-block;
      flex-shrink: 0;
      background: #222;
      transition: border 0.18s, box-shadow 0.18s;
    }
    .theme-option[data-theme="light"] .theme-dot {
      background: linear-gradient(135deg,#fff,#f5f6fa);
      border: 2.5px solid #e0e0e0;
    }
    .theme-option[data-theme="dark"] .theme-dot {
      background: linear-gradient(135deg,#23232b,#3a4664);
      border: 2.5px solid #444;
    }
    .theme-option[data-theme="aura-celeste"] .theme-dot {
      background: linear-gradient(135deg,#2a3140 60%,#38475a 100%);
      border: 2.5px solid rgba(120,150,180,0.35);
    }
    .theme-option[data-theme="aura-rosa"] .theme-dot {
      background: linear-gradient(135deg,#3a2a3e 60%,#4a314a 100%);
      border: 2.5px solid rgba(120,100,120,0.35);
    }
    .theme-option[data-theme="aura-verde"] .theme-dot {
      background: linear-gradient(135deg,#22322a 60%,#3a4d3a 100%);
      border: 2.5px solid rgba(100,120,100,0.35);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Temi Aura e gradienti SU TUTTA LA PAGINA */
    body.theme-aura-celeste {
      --primary: #eaf6ff;
      --primary-light: #b7c7d9;
      --primary-dark: #1a2636;
      --accent: #4fc3f7;
      --border: rgba(120,150,180,0.35);
      --user-bubble: linear-gradient(135deg, #2a3140 60%, #38475a 100%);
      --user-bubble-border: rgba(120,150,180,0.35);
      --annina-bubble: linear-gradient(135deg, #232b3e 60%, #2a3140 100%);
      --annina-bubble-border: rgba(120,150,180,0.35);
      --header-bg: linear-gradient(90deg, #2a3140 0%, #38475a 100%);
      --input-bg: #232b3e;
      --avatar-glow: 0 0 0 6px rgba(120,150,180,0.18), 0 0 18px 2px #232b3e44;
      background: linear-gradient(135deg, #232b3e 0%, #38475a 100%) !important;
      --text-bright: #fafdff;
      --icon-muted: #b0c4d4;
    }
    body.theme-aura-rosa {
      --primary: #fbeaf3;
      --primary-light: #e7b7c8;
      --primary-dark: #4d2a3a;
      --accent: #e573b7;
      --border: rgba(120,100,120,0.35);
      --user-bubble: linear-gradient(135deg, #3a2a3e 60%, #4a314a 100%);
      --user-bubble-border: rgba(120,100,120,0.35);
      --annina-bubble: linear-gradient(135deg, #2d1a2e 60%, #3a2a3e 100%);
      --annina-bubble-border: rgba(120,100,120,0.35);
      --header-bg: linear-gradient(90deg, #3a2a3e 0%, #4a314a 100%);
      --input-bg: #2d1a2e;
      --avatar-glow: 0 0 0 6px rgba(120,100,120,0.18), 0 0 18px 2px #2d1a2e44;
      background: linear-gradient(135deg, #2d1a2e 0%, #4a314a 100%) !important;
      --text-bright: #fff0f6;
      --icon-muted: #c8b0b8;
    }
    body.theme-aura-verde {
      --primary: #eafaf3;
      --primary-light: #b7e7d1;
      --primary-dark: #2a4d3a;
      --accent: #4fd1a1;
      --border: rgba(100,120,100,0.35);
      --user-bubble: linear-gradient(135deg, #22322a 60%, #3a4d3a 100%);
      --user-bubble-border: rgba(100,120,100,0.35);
      --annina-bubble: linear-gradient(135deg, #1e2d26 60%, #22322a 100%);
      --annina-bubble-border: rgba(100,120,100,0.35);
      --header-bg: linear-gradient(90deg, #22322a 0%, #3a4d3a 100%);
      --input-bg: #1e2d26;
      --avatar-glow: 0 0 0 6px rgba(100,120,100,0.18), 0 0 18px 2px #1e2d2644;
      background: linear-gradient(135deg, #1e2d26 0%, #3a4d3a 100%) !important;
      --text-bright: #fafdff;
      --icon-muted: #b0c4b0;
    }
    body.theme-aura-celeste .chat-header,
    body.theme-aura-rosa .chat-header,
    body.theme-aura-verde .chat-header {
      background: var(--header-bg) !important;
      border-bottom: 3px solid #ffe066;
      box-shadow: 0 2px 0 0 #ffe06644;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: var(--primary-dark);
      min-height: 100vh;
      color: var(--primary-light);
      -webkit-tap-highlight-color: transparent;
    }
    body.light-mode {
      background: #f7f7f7;
      color: #181818;
    }
    body.light-mode .chat-main-wrapper,
    body.light-mode .chat-header,
    body.light-mode .chat-header .avatar,
    body.light-mode .chat-header-controls button,
    body.light-mode .theme-popup-btn,
    body.light-mode .theme-popup-menu,
    body.light-mode .theme-option,
    body.light-mode .msg-avatar,
    body.light-mode .message,
    body.light-mode .chat-input-bar,
    body.light-mode .chat-input-bar input,
    body.light-mode .chat-input-bar button,
    body.light-mode .chat-input-bar a.feedback-btn {
      border-color: #181818 !important;
    }
    body.light-mode .chat-header-controls button,
    body.light-mode .theme-popup-btn,
    body.light-mode .theme-popup-menu,
    body.light-mode .theme-option {
      border-width: 1.5px;
    }
    body.light-mode .chat-header {
      background: #fff;
      border-bottom: 1.5px solid #181818;
    }
    body.light-mode .chat-header .title {
      color: #181818;
    }
    body.light-mode .chat-header .subtitle {
      color: #d4af37;
    }
    body.light-mode .chat-header .avatar {
      background: #fff;
    }
    body.light-mode .chat-header-controls button {
      color: #d4af37;
    }
    body.light-mode .chat-header-controls button:hover {
      color: #181818;
    }
    body.light-mode .chat-container {
      background: #f7f7f7;
    }
    body.light-mode .msg-avatar {
      background: #fff;
    }
    body.light-mode .msg-avatar.user {
      background: #f7f7f7;
    }
    body.light-mode .message {
      background: #fff;
      color: #181818;
    }
    body.light-mode .message-row.user .message {
      background: #f7f7f7;
      color: #181818;
    }
    body.light-mode .message-row.annina .message {
      background: #fff;
      color: #181818;
    }
    body.light-mode .chat-input-bar {
      background: #fff;
      border-top: 1.5px solid #181818;
    }
    body.light-mode .chat-input-bar input {
      background: #f7f7f7;
      color: #181818;
    }
    body.light-mode .chat-input-bar input:focus {
      background: #fff;
      color: #181818;
    }
    body.light-mode .chat-input-bar button,
    body.light-mode .chat-input-bar a.feedback-btn {
      background: #fff;
      color: #d4af37;
    }
    body.light-mode .chat-input-bar button:hover,
    body.light-mode .chat-input-bar a.feedback-btn:hover {
      background: #d4af37;
      color: #fff;
    }
    body.light-mode .chat-input-bar button:disabled {
      background: #f7f7f7;
      color: #b0b0b0;
      border: 1.5px solid #181818;
    }
    body.light-mode .chat-input-bar a.feedback-btn {
      background: #f7f7f7;
      color: #181818;
    }
    body.light-mode .chat-input-bar a.feedback-btn:hover {
      background: #d4af37;
      color: #fff;
    }
    body.dark-mode .chat-main-wrapper,
    body.dark-mode .chat-header,
    body.dark-mode .chat-header .avatar,
    body.dark-mode .chat-header-controls button,
    body.dark-mode .theme-popup-btn,
    body.dark-mode .theme-popup-menu,
    body.dark-mode .theme-option,
    body.dark-mode .msg-avatar,
    body.dark-mode .message,
    body.dark-mode .chat-input-bar,
    body.dark-mode .chat-input-bar input,
    body.dark-mode .chat-input-bar button,
    body.dark-mode .chat-input-bar a.feedback-btn {
      border-color: #fff !important;
    }
    body.dark-mode .chat-header-controls button,
    body.dark-mode .theme-popup-btn,
    body.dark-mode .theme-popup-menu,
    body.dark-mode .theme-option {
      border-width: 1.5px;
    }
    .chat-main-wrapper {
      max-width: 520px;
      margin: 0 auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--primary-dark);
      border-radius: 22px;
      box-shadow: 0 2px 32px 0 #000a;
      overflow: hidden;
      position: relative;
      border: 1.5px solid var(--border);
      transition: background var(--transition), border var(--transition);
    }
    body.dark-mode .chat-main-wrapper {
      background: transparent;
      border: 1px solid #23232b;
      box-shadow: 0 2px 16px 0 #0002;
    }
    body.theme-aura-celeste .chat-main-wrapper,
    body.theme-aura-rosa .chat-main-wrapper,
    body.theme-aura-verde .chat-main-wrapper {
      background: transparent;
      border: 2px solid var(--border);
      box-shadow: 0 2px 24px 0 var(--border)22;
    }
    .chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1.2rem;
      background: var(--header-bg);
      border-bottom: 1.5px solid var(--header-border);
      min-height: 54px;
      position: sticky;
      top: 0;
      z-index: 2;
      transition: background var(--transition), border-bottom var(--transition);
      box-shadow: none;
    }
    body.dark-mode .chat-header {
      background: #23232b;
      border-bottom: 3px solid #ffe066;
      box-shadow: 0 2px 0 0 #d4af3722;
    }
    .chat-header-left {
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }
    .chat-header .avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: var(--user-bubble);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 1.5px solid var(--accent);
      box-shadow: none;
      transition: border 0.3s, background 0.3s;
    }
    .chat-header .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .chat-header .title {
      font-size: 1.18rem;
      font-weight: 700;
      letter-spacing: 0.01em;
      color: var(--primary-light);
      margin-bottom: 2px;
      text-shadow: none;
    }
    .chat-header .subtitle {
      font-size: 0.97rem;
      color: var(--accent);
      font-weight: 400;
      margin-top: 0;
      text-shadow: none;
    }
    body.dark-mode .chat-header .title {
      color: var(--text-bright);
      text-shadow: 0 1px 2px #23232b, 0 0 2px #ffe06644;
    }
    body.dark-mode .chat-header .subtitle {
      color: #ffe066;
      text-shadow: 0 1px 2px #23232b;
    }
    .chat-header-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .chat-header-controls button {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.25rem;
      cursor: pointer;
      border-radius: 50%;
      padding: 0.35em 0.45em;
      transition: color 0.18s;
    }
    .chat-header-controls button:hover {
      color: #fff;
    }
    body.dark-mode .chat-header-controls button:hover,
    body.theme-aura-celeste .chat-header-controls button:hover,
    body.theme-aura-rosa .chat-header-controls button:hover,
    body.theme-aura-verde .chat-header-controls button:hover {
      background: var(--primary-dark, #23232b);
      color: var(--accent);
    }
    .sound-toggle .fa-volume-mute { display: none; }
    .sound-toggle.sound-muted .fa-volume-up { display: none; }
    .sound-toggle.sound-muted .fa-volume-mute { display: inline; }
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1.2rem 1.2rem 0.7rem 1.2rem;
      overflow-y: auto;
      background: var(--primary-dark);
      transition: background var(--transition);
    }
    .message-row {
      display: flex;
      align-items: flex-end;
      margin-bottom: 0.35rem;
      padding-left: 4px;
      padding-right: 4px;
    }
    .message-row.annina {
      flex-direction: row;
      justify-content: flex-start;
    }
    .message-row.user {
      flex-direction: row-reverse;
      justify-content: flex-end;
    }
    .msg-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 6px 2px 0;
      overflow: hidden;
      border: 1.5px solid #fff;
      box-shadow: 0 1px 4px #0001;
    }
    .msg-avatar.user {
      margin: 0 0 2px 6px;
      background: #dcf8c6;
    }
    body.light-mode .msg-avatar {
      border: 1.5px solid #181818;
    }
    .msg-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .message {
      max-width: 75vw;
      min-width: 36px;
      padding: 0.62rem 1.05rem;
      font-size: 1.01rem;
      line-height: 1.6;
      background: #fff;
      color: #181818;
      border-radius: 18px 18px 18px 4px;
      box-shadow: 0 1px 2px #0001;
      border: 1.5px solid #fff;
      margin: 0 0 2px 0;
      word-break: break-word;
      transition: background var(--transition), color var(--transition), border var(--transition);
    }
    .message-row.user .message {
      background: #dcf8c6;
      color: #181818;
      border-radius: 18px 18px 4px 18px;
      margin-left: 0;
      margin-right: 0.2rem;
      box-shadow: 0 1px 2px #0001;
      border: 1.5px solid #fff;
    }
    .message-row.annina .message {
      background: #fff;
      color: #181818;
      border-radius: 18px 18px 18px 4px;
      margin-right: 0;
      margin-left: 0.2rem;
      box-shadow: 0 1px 2px #0001;
      border: 1.5px solid #fff;
    }
    body.dark-mode .message-row.user .message,
    body.dark-mode .message-row.annina .message,
    body.dark-mode .message {
      border: 1.5px solid #fff;
    }
    body.light-mode .message-row.user .message,
    body.light-mode .message-row.annina .message,
    body.light-mode .message {
      border: 1.5px solid #181818;
    }
    body.dark-mode .message-row.user .message,
    body.dark-mode .message-row.annina .message,
    body.theme-aura-celeste .message-row.user .message,
    body.theme-aura-celeste .message-row.annina .message,
    body.theme-aura-rosa .message-row.user .message,
    body.theme-aura-rosa .message-row.annina .message,
    body.theme-aura-verde .message-row.user .message,
    body.theme-aura-verde .message-row.annina .message {
      color: var(--text-bright, #fff);
      text-shadow: 0 1px 8px #000b;
    }
    body.dark-mode .message {
      background: #23232b;
      color: #f5f5f7;
      border: 1.5px solid #2d2d38;
    }
    body.dark-mode .message-row.user .message {
      background: #2d2d38;
      color: #f5f5f7;
      border: 1.5px solid #d4af37;
    }
    body.dark-mode .message-row.annina .message {
      background: #23232b;
      color: #f5f5f7;
      border: 2.5px solid #ffe066;
      box-shadow: 0 0 0 2px #23232b, 0 0 8px 0 #ffe06644;
    }
    .typing-indicator {
      display: flex;
      align-items: center;
      height: 28px;
      padding: 0 10px;
      gap: 0.3rem;
    }
    .typing-dot {
      width: 7px;
      height: 7px;
      margin: 0 2px;
      border-radius: 50%;
      background: var(--accent);
      opacity: 0.7;
      animation: typing-bounce 1s infinite both;
    }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    .typing-text {
      font-size: 0.98em;
      color: var(--accent);
      margin-left: 0.7em;
      font-style: italic;
      letter-spacing: 0.01em;
      opacity: 0.85;
      animation: typing-fade 1.2s infinite alternate;
      text-shadow: 0 1px 4px var(--annina-bubble, #fff8);
    }
    @keyframes typing-bounce {
      0%, 80%, 100% { transform: translateY(0); opacity: 0.7; }
      40% { transform: translateY(-6px); opacity: 1; }
    }
    @keyframes typing-fade {
      0% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    @keyframes shake {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-3px); }
      40%, 60% { transform: translateX(3px); }
    }
    .chat-input--shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    .chat-input-bar {
      display: flex;
      align-items: center;
      padding: 0.7rem 1.2rem;
      background: var(--primary-dark);
      border-top: 1.5px solid var(--accent);
      gap: 0.5rem;
      position: sticky;
      bottom: 0;
      z-index: 2;
      transition: background var(--transition), border var(--transition);
      box-shadow: none;
    }
    .chat-input-bar input {
      flex: 1;
      padding: 0.9rem 1.1rem;
      border-radius: 18px;
      border: 1.5px solid var(--accent);
      font-size: 1.08rem;
      outline: none;
      background: var(--user-bubble);
      color: var(--primary-dark);
      box-shadow: none;
      transition: border var(--transition), background var(--transition), color var(--transition);
    }
    .chat-input-bar input:focus {
      border: 1.5px solid var(--accent);
      background: #fffbe6;
    }
    .chat-input-bar input::placeholder {
      color: var(--icon-muted);
      opacity: 1;
      font-style: italic;
    }
    .chat-input-bar .input-btns {
      display: flex;
      align-items: center;
      gap: 0.2rem;
    }
    .chat-input-bar button, .chat-input-bar a.feedback-btn {
      background: var(--primary-dark);
      color: var(--accent);
      border: 1.5px solid var(--accent);
      border-radius: 50%;
      width: 38px;
      height: 38px;
      font-size: 1.18rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background var(--transition), color var(--transition), border var(--transition);
      text-decoration: none;
      box-shadow: none;
    }
    .chat-input-bar button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: var(--user-bubble);
      color: var(--icon-muted);
      border: 1.5px solid var(--border);
    }
    .chat-input-bar button:hover, .chat-input-bar a.feedback-btn:hover {
      background: var(--accent);
      color: var(--primary-dark);
      border: 1.5px solid var(--accent);
    }
    .chat-input-bar a.feedback-btn {
      font-size: 1.08rem;
      margin-left: 0.1rem;
      background: var(--user-bubble);
      color: var(--primary-dark);
      border: 1.5px solid var(--accent);
    }
    .chat-input-bar a.feedback-btn:hover {
      background: var(--accent);
      color: var(--primary-dark);
    }
    @media (max-width: 600px) {
      html, body {
        height: 100dvh;
        min-height: 100dvh;
        overflow: hidden;
      }
      .chat-main-wrapper {
        max-width: 100vw;
        width: 100vw;
        height: 100dvh;
        min-height: 100dvh;
        border-radius: 0;
        margin: 0;
        border: none;
        box-shadow: none;
        display: flex;
        flex-direction: column;
      }
      .chat-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        width: 100vw;
        z-index: 100;
        padding: 0.5rem 0.8rem 0.5rem 0.8rem;
        min-height: 48px;
        border-radius: 0;
        box-shadow: 0 1px 0 #0001;
      }
      .chat-header .avatar {
        width: 28px;
        height: 28px;
      }
      .chat-header .title {
        font-size: 1.08rem;
      }
      .chat-header .subtitle {
        font-size: 0.85rem;
      }
      .chat-container {
        flex: 1 1 auto;
        padding: 0.7rem 0.5rem 0.2rem 0.5rem;
        margin-top: 48px;
        margin-bottom: 0;
        min-height: 0;
        max-height: calc(100dvh - 48px - 56px);
        background: var(--primary-dark);
        overflow-y: auto;
        box-sizing: border-box;
      }
      .chat-input-bar {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100vw;
        border-radius: 0;
        z-index: 101;
        box-shadow: 0 -1px 0 #0001;
        background: var(--primary-dark);
        padding: 0.4rem 0.7rem 0.4rem 0.7rem;
        transition: transform 0.25s, opacity 0.25s;
        display: flex;
        align-items: center;
      }
      .chat-input-bar.hidden {
        transform: translateY(100%);
        opacity: 0;
        pointer-events: none;
      }
      .chat-input-bar input {
        font-size: 1.05rem;
        padding: 0.7rem 1rem;
        min-height: 36px;
        border-radius: 14px;
      }
      .chat-input-bar .input-btns {
        gap: 0.2rem;
      }
      .chat-input-bar button, .chat-input-bar a.feedback-btn {
        width: 36px;
        height: 36px;
        font-size: 1.08rem;
      }
      .message {
        font-size: 0.98rem;
        max-width: 78vw;
        min-width: 36px;
        box-sizing: border-box;
        padding: 0.7rem 0.9rem;
        border-radius: 18px 18px 18px 6px;
        word-break: break-word;
        white-space: pre-line;
      }
      .message-row.user .message {
        margin-right: 2vw;
        margin-left: auto;
        border-radius: 18px 18px 6px 18px;
      }
      .message-row.annina .message {
        margin-left: 2vw;
        margin-right: auto;
        border-radius: 18px 18px 18px 6px;
      }
      .msg-avatar { width: 20px; height: 20px; }
    }
    @media (min-width: 800px) {
      .chat-main-wrapper {
        max-width: 100vw;
        width: 100vw;
        height: 100vh;
        min-height: 100vh;
        border-radius: 0;
        margin: 0;
        border: none;
      }
    }
  </style>
</head>
<body>
  <div class="chat-main-wrapper">
    <div class="chat-header">
      <div class="chat-header-left">
        <div class="avatar">
          <img src="/assets/annina.png" alt="Annina" id="annina-avatar" />
        </div>
        <div>
          <div class="title">Annina</div>
          <div class="subtitle">Chat</div>
        </div>
      </div>
      <div class="chat-header-controls">
      <div class="theme-popup-wrapper">
      <button id="theme-popup-btn" class="theme-popup-btn" title="Scegli stile navbar" aria-haspopup="true" aria-expanded="false">
      <i class="fas fa-palette"></i>
      </button>
      <div id="theme-popup" class="theme-popup-menu" tabindex="-1">
      <div class="theme-option" data-theme="light"><span class="theme-dot" style="background:linear-gradient(90deg,#fff,#f5f6fa);"></span> Light</div>
      <div class="theme-option" data-theme="dark"><span class="theme-dot" style="background:linear-gradient(90deg,#23232b,#3a4664);"></span> Dark</div>
      <div class="theme-option" data-theme="aura-celeste"><span class="theme-dot" style="background:linear-gradient(90deg,#3498db,#c5e3f8);"></span> Aura Celeste</div>
      <div class="theme-option" data-theme="aura-rosa"><span class="theme-dot" style="background:linear-gradient(90deg,#d91e5b,#fccde0);"></span> Aura Rosa</div>
      <div class="theme-option" data-theme="aura-verde"><span class="theme-dot" style="background:linear-gradient(90deg,#27ae60,#b3e6c9);"></span> Aura Verde</div>
      </div>
      </div>
      <button class="sound-toggle" id="sound-toggle" title="Attiva/Disattiva suono">
      <i class="fas fa-volume-up"></i>
      <i class="fas fa-volume-mute"></i>
      </button>
      <button class="theme-switch" id="theme-switch" title="Cambia tema">
      <i class="fas fa-moon"></i>
      <i class="fas fa-sun"></i>
      </button>
      </div>
    </div>
    <div class="chat-container" id="chat-container">
      <div class="message-row annina" id="motivational-row">
        <div class="msg-avatar annina">
          <img src="/assets/annina.png" alt="Annina" />
        </div>
        <div class="message" id="motivational-message"></div>
      </div>
    </div>
    <form class="chat-input-bar" id="chat-form" autocomplete="off">
      <input type="text" id="chat-input" placeholder="Parlami di come ti senti oggiâ€¦ ðŸ’­" required />
      <div class="input-btns">
        <button type="submit"><i class="fas fa-paper-plane"></i></button>
        <a href="/src/feedback.html" class="feedback-btn" title="Lascia un feedback su Annina" target="_blank"><i class="fas fa-comments"></i></a>
      </div>
    </form>
  </div>
  <script>
  // Gestione temi navbar
  const themePopupBtn = document.getElementById('theme-popup-btn');
  const themePopup = document.getElementById('theme-popup');
  const themeOptions = themePopup ? themePopup.querySelectorAll('.theme-option') : [];
  const chatHeader = document.querySelector('.chat-header');
  function applyNavbarTheme(theme) {
  document.body.classList.remove('dark-mode', 'theme-aura-celeste', 'theme-aura-rosa', 'theme-aura-verde');
  if (theme === 'dark') {
  document.body.classList.add('dark-mode');
  } else if (theme === 'aura-celeste') {
  document.body.classList.add('theme-aura-celeste');
  } else if (theme === 'aura-rosa') {
  document.body.classList.add('theme-aura-rosa');
  } else if (theme === 'aura-verde') {
  document.body.classList.add('theme-aura-verde');
  }
  // Light Ã¨ default, nessuna classe
  localStorage.setItem('anninaNavbarTheme', theme);
  // Aggiorna selezione visiva
  themeOptions.forEach(opt => {
  opt.classList.toggle('selected', opt.dataset.theme === theme);
  });
  }
  if (themePopupBtn && themePopup) {
  themePopupBtn.addEventListener('click', () => {
  const expanded = themePopupBtn.getAttribute('aria-expanded') === 'true';
  themePopupBtn.setAttribute('aria-expanded', !expanded);
  themePopup.classList.toggle('open');
  if (!expanded) themePopup.focus();
  });
  themeOptions.forEach(opt => {
  opt.addEventListener('click', () => {
  applyNavbarTheme(opt.dataset.theme);
  themePopup.classList.remove('open');
  themePopupBtn.setAttribute('aria-expanded', 'false');
  });
  });
  // Chiudi popup cliccando fuori
  document.addEventListener('mousedown', e => {
  if (!themePopup.contains(e.target) && !themePopupBtn.contains(e.target)) {
  themePopup.classList.remove('open');
  themePopupBtn.setAttribute('aria-expanded', 'false');
  }
  });
  // All'avvio, imposta il tema salvato
  const savedTheme = localStorage.getItem('anninaNavbarTheme') || 'light';
  applyNavbarTheme(savedTheme);
  }
  // Messaggi motivazionali random
  const motivationalMessages = [
  "Ciao, sono Annina ðŸŒ¸ Vuoi raccontarmi come stai oggi?",
  "Scrivimi un pensiero, un dubbio o anche solo un â€œciaoâ€ ðŸ’­",
  "Eccomi qui, pronta ad ascoltarti. Da dove vogliamo cominciare? ðŸ˜Š",
  "Va tutto bene? Se hai bisogno, sono qui per te ðŸ’—",
  "Cosa ti passa per la testa in questo momento? Raccontamelo âœ¨",
  "Un pensiero, unâ€™idea o una domanda curiosa? Scrivimi âœï¸",
  "Dimmi qualcosa che solo tu stai pensando adesso ðŸ’«.",
  "Oggi sento che potremmo scoprire qualcosa di nuovo insieme ðŸ¤",
  "Se vuoi, possiamo parlare di tuttoâ€¦ o di niente ðŸ’¬",
  "Parliamo di ciÃ² che conta per te oggi? ðŸŒ¿",
  "Sono Annina, la tua AI di fiducia. Iniziamo a chiacchierare? ðŸ§ ðŸ’¬",
  "Vuoi provare a farmi una domanda? Sono tutta orecchie (digitali) ðŸ‘‚",
  "Scrivimi come ti sentiâ€¦ anche se non sai da dove iniziare ðŸŒ™",
  "Ogni conversazione inizia con una parola. Qual Ã¨ la tua?",
  "Sei importante, non dimenticarlo mai."
  ];
  window.addEventListener('DOMContentLoaded', () => {
  const msg = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
  const el = document.getElementById('motivational-message');
  if (el) el.textContent = msg;
  });
  // Avatar di esempio per Annina e utente
  const anninaAvatar = '/assets/annina.png';
  const userAvatar = '/assets/user.png';
  const form = document.getElementById('chat-form');
  const input = document.getElementById('chat-input');
  const chatBox = document.getElementById('chat-container');
  const sendButton = form.querySelector('button[type="submit"]');
  const notificationSound = new Audio('/assets/notification.mp3');
  let originalTitle = document.title;
  const newMessagesTitle = "ðŸ’¬ Nuovo Messaggio!";
  let blinkIntervalId = null;
  let isBlinking = false;
  const soundToggleBtn = document.getElementById('sound-toggle');
  const volumeUpIcon = soundToggleBtn.querySelector('.fa-volume-up');
  const volumeMuteIcon = soundToggleBtn.querySelector('.fa-volume-mute');
  let soundEnabled = true;
  function appendMessage(sender, text, isTyping = false) {
  const messageRow = document.createElement('div');
  messageRow.className = `message-row ${sender === 'Tu' ? 'user' : 'annina'}`;
  if (isTyping) {
  messageRow.classList.add('typing-row');
  }
  const msgAvatarDiv = document.createElement('div');
  msgAvatarDiv.className = `msg-avatar ${sender === 'Tu' ? 'user' : 'annina'}`;
  const avatarImg = document.createElement('img');
  avatarImg.src = sender === 'Tu' ? userAvatar : anninaAvatar;
  avatarImg.alt = sender;
  msgAvatarDiv.appendChild(avatarImg);
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message';
  if (isTyping) {
  messageDiv.innerHTML = `<div class=\"typing-indicator\"><span class=\"typing-dot\"></span><span class=\"typing-dot\"></span><span class=\"typing-dot\"></span><span class=\"typing-text\">Annina sta scrivendo...</span></div>`;
  } else {
  messageDiv.innerHTML = text;
  }
  messageRow.appendChild(msgAvatarDiv);
  messageRow.appendChild(messageDiv);
  chatBox.appendChild(messageRow);
  chatBox.scrollTop = chatBox.scrollHeight;
  }
  function removeLastMessage() {
  const typingRow = chatBox.querySelector('.typing-row');
  if (typingRow) {
  chatBox.removeChild(typingRow);
  }
  }
  form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const message = input.value.trim();
  if (!message) {
  form.classList.add('chat-input--shake');
  setTimeout(() => { form.classList.remove('chat-input--shake'); }, 500);
  return;
  }
  appendMessage("Tu", message);
  input.value = '';
  appendMessage("Annina", "", true);
  try {
  const response = await fetch('https://anninaai.onrender.com/chat', {
  method: 'POST',
  headers: {
  'Content-Type': 'application/json',
  },
  body: JSON.stringify({ message }),
  });
  const data = await response.json();
  removeLastMessage();
  if (data.response) {
  appendMessage("Annina", data.response);
  if (soundEnabled) {
  notificationSound.play().catch(error => console.warn("Impossibile riprodurre il suono di notifica:", error));
  }
  if (document.hidden) {
  startTitleBlink();
  }
  } else if (data && data.error) {
  appendMessage("Annina", `Errore: ${data.error}`);
  }
  } catch (error) {
  console.error('Errore durante la comunicazione con il backend:', error);
  removeLastMessage();
  appendMessage("Annina", 'Errore di connessione con Annina. Riprova piÃ¹ tardi.');
  }
  updateChatInputState();
  });
    const themeSwitch = document.getElementById('theme-switch');
    function setTheme(mode) {
      document.body.classList.remove('dark-mode', 'light-mode');
      if (mode === 'dark') {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.add('light-mode');
      }
      localStorage.setItem('anninaTheme', mode);
    }
    themeSwitch.addEventListener('click', function() {
      if (document.body.classList.contains('dark-mode')) {
        setTheme('light');
      } else {
        setTheme('dark');
      }
    });
    const savedTheme = localStorage.getItem('anninaTheme');
    if(savedTheme === 'dark' || savedTheme === 'light') {
      setTheme(savedTheme);
    } else {
      setTheme('dark');
    }
    function setSoundPreference(enabled) {
      soundEnabled = enabled;
      localStorage.setItem('anninaSoundEnabled', enabled);
      if (enabled) {
        soundToggleBtn.classList.remove('sound-muted');
        soundToggleBtn.title = "Disattiva suono";
      } else {
        soundToggleBtn.classList.add('sound-muted');
        soundToggleBtn.title = "Attiva suono";
      }
    }
    soundToggleBtn.addEventListener('click', () => {
      setSoundPreference(!soundEnabled);
    });
    const savedSoundPreference = localStorage.getItem('anninaSoundEnabled');
    setSoundPreference(savedSoundPreference === null ? true : savedSoundPreference === 'true');
    if (input && form && sendButton) {
      function updateChatInputState() {
        const hasFocus = document.activeElement === input;
        const hasText = input.value.trim().length > 0;
        if (hasFocus) {
          form.classList.add('chat-input--active-aura');
        } else {
          form.classList.remove('chat-input--active-aura');
        }
        sendButton.disabled = !hasText;
      }
      input.addEventListener('focus', updateChatInputState);
      input.addEventListener('blur', updateChatInputState);
      input.addEventListener('input', updateChatInputState);
      updateChatInputState();
    }
    function startTitleBlink() {
      if (isBlinking) return;
      isBlinking = true;
      let isOriginal = true;
      blinkIntervalId = setInterval(() => {
        document.title = isOriginal ? newMessagesTitle : originalTitle;
        isOriginal = !isOriginal;
      }, 1000);
    }
    function stopTitleBlink() {
      if (!isBlinking) return;
      clearInterval(blinkIntervalId);
      document.title = originalTitle;
      isBlinking = false;
      blinkIntervalId = null;
    }
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        stopTitleBlink();
      }
    });
  // Nascondi barra input quando si scrolla giÃ¹, riappare quando si risale
  (function() {
    const chatContainer = document.getElementById('chat-container');
    const chatInputBar = document.querySelector('.chat-input-bar');
    let lastScrollTop = 0;
    let ticking = false;
    if (chatContainer && chatInputBar) {
      chatContainer.addEventListener('scroll', function() {
        if (!ticking) {
          window.requestAnimationFrame(function() {
            const st = chatContainer.scrollTop;
            if (st > lastScrollTop + 10) {
              // Scroll giÃ¹
              chatInputBar.classList.add('hidden');
            } else if (st < lastScrollTop - 10) {
              // Scroll su
              chatInputBar.classList.remove('hidden');
            }
            lastScrollTop = st <= 0 ? 0 : st;
            ticking = false;
          });
          ticking = true;
        }
      });
    }
  })();
  </script>
  <script src="/harmonia/main.js"></script>
</body>
</html>
